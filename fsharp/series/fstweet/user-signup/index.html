<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme" content="hugo-academic">
  <meta name="generator" content="Hugo 0.26" />
  
  <meta name="description" content="Demystifying">

  
  
  
    
  
  
    
    
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/vs.min.css">
    
  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha512-6MXa8B6uaO18Hid6blRMetEIoPqHf7Ux1tnyIQdpt9qI5OACx7C+O3IVTr98vwGnlcg0LOLa02i9Y1HpVhlfiw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.0/css/academicons.min.css" integrity="sha512-GGGNUPDhnG8LEAEDsjqYIQns+Gu8RBs4j5XGlxl7UfRaZBhCCm5jenJkeJL8uPuOXGqgl8/H1gjlWQDRjd3cUQ==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha512-SfTiTlX6kk+qitfevl/7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+/Sw==" crossorigin="anonymous">
  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather%7CRoboto+Mono">
  <link rel="stylesheet" href="/css/hugo-academic.css">
  
  <link rel="stylesheet" href="/css/custom.css">
  

  

  <link rel="alternate" href="http://www.demystifyfp.com/index.xml" type="application/rss+xml" title="Demystify FP">
  <link rel="feed" href="http://www.demystifyfp.com/index.xml" type="application/rss+xml" title="Demystify FP">

  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/apple-touch-icon.png">

  <link rel="canonical" href="http://www.demystifyfp.com/fsharp/series/fstweet/user-signup/">

  

  <title>Handling User signup Form | Demystify FP</title>

</head>
<body id="top" data-spy="scroll" data-target="#navbar-main" data-offset="71">

<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">Demystify FP</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav navbar-right">
        

        

        <li class="nav-item">
          <a href="/#about">
            
            <span>Home</span>
          </a>
        </li>

        
        

        
      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  


  <div class="article-container">
    <h1 itemprop="name">Handling User signup Form</h1>
    

<div class="article-metadata">

  <span class="article-date">
    <time datetime="2017-08-19 16:37:26 &#43;0530 IST" itemprop="datePublished">
      Sat, Aug 19, 2017
    </time>
  </span>

  

  
  
  
  <span class="article-tags">
    <i class="fa fa-tags"></i>
    
    <a href="/tags/suave">suave</a
    >, 
    
    <a href="/tags/forge">forge</a
    >, 
    
    <a href="/tags/fsharp">fsharp</a
    >
    
  </span>
  
  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=http%3a%2f%2fwww.demystifyfp.com%2ffsharp%2fseries%2ffstweet%2fuser-signup%2f"
         target="_blank">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=Handling%20User%20signup%20Form&amp;url=http%3a%2f%2fwww.demystifyfp.com%2ffsharp%2fseries%2ffstweet%2fuser-signup%2f"
         target="_blank">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2fwww.demystifyfp.com%2ffsharp%2fseries%2ffstweet%2fuser-signup%2f&amp;title=Handling%20User%20signup%20Form"
         target="_blank">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=http%3a%2f%2fwww.demystifyfp.com%2ffsharp%2fseries%2ffstweet%2fuser-signup%2f&amp;title=Handling%20User%20signup%20Form"
         target="_blank">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=Handling%20User%20signup%20Form&amp;body=http%3a%2f%2fwww.demystifyfp.com%2ffsharp%2fseries%2ffstweet%2fuser-signup%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>

    <div class="article-style" itemprop="articleBody">
      

<p>In the <a href="/fsharp/series/fstweet/static-assets/" target="_blank">last blog post</a>, we added a cool landing page for <em>FsTweet</em> to increase the user signups. But the signup form and its backend are not ready yet!</p>

<p>In this fourth part, we will be extending <em>FsTweet</em> to serve the signup page and implement its backend scaffolding</p>

<h2 id="a-new-file-for-user-signup">A New File For User Signup</h2>

<p>Let&rsquo;s get started by creating a new file <em>UserSignup.fs</em> in the <em>FsTweet.Web.fsproj</em> file using Forge.</p>

<pre><code class="language-bash">&gt; forge new file -t fs \
    -p src/FsTweet.Web/FsTweet.Web.fsproj \
    -n src/FsTweet.Web/UserSignup
</code></pre>

<p>The next step is moving this file above <em>FsTweet.Web.fs</em> file as we will be referring <code>UserSignup</code> in the <code>Main</code> function.</p>

<p>Using Forge, we can achieve it using the following command</p>

<pre><code class="language-bash">&gt; forge move file -p src/FsTweet.Web/FsTweet.Web.fsproj \
    -n src/FsTweet.Web/UserSignup.fs -u
</code></pre>

<p>Though working with the command line is productive than its visual counterpart, the commands that we typed for creating and moving a file is verbose.</p>

<p>Forge has <a href="https://github.com/fsharp-editing/Forge/wiki/aliases#alias-definition" target="_blank">an advanced feature called alias</a> using which we can get rid of the boilerplate to a large extent.</p>

<p>As we did for the forge <a href="/fsharp/series/fstweet/project-setup/" target="_blank">Run alias</a> during the project setup, let&rsquo;s add few three more alias</p>

<pre><code class="language-toml"># ...
  web='-p src/FsTweet.Web/FsTweet.Web.fsproj'
  newFs='new file -t fs'
  moveUp='move file -u'
</code></pre>

<p>The <code>web</code> is an alias for the project argument in the Forge commands. The <code>newFs</code> and <code>moveUp</code> alias are for the <code>new file</code> and <code>move file</code> operations respectively.</p>

<p>If we had this alias beforehand, we could have used the following commands to do what we just did</p>

<pre><code class="language-bash">&gt; forge newFs web -n src/FsTweet.Web/UserSignup
&gt; forge moveUp web -n src/FsTweet.Web/UserSignup.fs
</code></pre>

<blockquote>
<p>We can generalize the alias as</p>

<pre><code class="language-bash">forge {operation-alias} {project-alias} {other-arguments}
</code></pre>
</blockquote>

<h2 id="serving-user-signup-page">Serving User Signup Page</h2>

<p>The first step is to serve the user signup page in response to the <code>/signup</code> request from the browser.</p>

<p>As we will be capturing the user details during signup, we need to use an view model while using the dotliquid template for the signup page.</p>

<p>In the <em>UserSignup.fs</em>, define a namespace <code>UserSignup</code> and a module <code>Suave</code> with a <code>webPart</code> function.</p>

<pre><code class="language-fsharp">// FsTweet.Web/UserSignup.fs
namespace UserSignup

module Suave =

  open Suave.Filters
  open Suave.Operators
  open Suave.DotLiquid

  //
  let webPart () =
    path &quot;/signup&quot;                  
      &gt;=&gt; page &quot;user/signup.liquid&quot; ??? 
</code></pre>

<p>The namespace represents the use case or the feature that we are about to implement. The modules inside the namespace represent the different layers of the use case implementation.</p>

<p>The <code>Suave</code> module defines the <code>Web</code> layer of the User Signup feature. You can learn about organizing modules from <a href="https://fsharpforfunandprofit.com/posts/recipe-part3/" target="_blank">this blog post</a>.</p>

<p>The <code>???</code> symbol is a placeholder that we need to fill in with a view model.</p>

<p>The view model has to capture user&rsquo;s email address, password, and username.</p>

<pre><code class="language-fsharp">// FsTweet.Web/UserSignup.fs
module Suave = 
  type UserSignupViewModel = {
    Username : string
    Email : string
    Password: string
    Error : string option
  }  
  let emptyUserSignupViewModel = {
    Username = &quot;&quot;
    Email = &quot;&quot;
    Password = &quot;&quot;
    Error = None
  }
  let webPart () =
    path &quot;/signup&quot; 
      &gt;=&gt; page &quot;user/signup.liquid&quot; emptyUserSignupViewModel
</code></pre>

<p>As the name indicates, <code>emptyUserSignupViewModel</code> provide the default values for the view model.</p>

<p>The <code>Error</code> property in the <code>UserSignupViewModel</code> record type is to communicate an error with the view.</p>

<p>The next step is creating a dotliquid template for the signup page.</p>

<pre><code class="language-html">&lt;!-- FsTweet.Web/views/user/signup.liquid --&gt;
{% extends &quot;master_page.liquid&quot; %}

{% block head %}
  &lt;title&gt; Sign Up - FsTweet &lt;/title&gt;
{% endblock %}

{% block content %}
&lt;form method=&quot;POST&quot; action=&quot;/signup&quot;&gt;
  {% if model.Error %}
    &lt;p&gt;{{ model.Error.Value }}&lt;/p&gt;
  {% endif %}
  &lt;input type=&quot;email&quot; name=&quot;Email&quot; value={{ model.Email }}&gt;
  &lt;input type=&quot;text&quot; name=&quot;Username&quot; value={{ model.Username }}&gt;
  &lt;input type=&quot;password&quot; name=&quot;Password&quot;&gt;
  &lt;button type=&quot;submit&quot;&gt;Sign up&lt;/button&gt;
&lt;/form&gt;
{% endblock %}
</code></pre>

<blockquote>
<p>For brevity, the styles and some HTML tags are ignored.</p>
</blockquote>

<p>In the template, the <code>name</code> attribute with its corresponding view model&rsquo;s property name as value is required to do the model binding on the server side.</p>

<p>And another thing to notice here is the <code>if</code> condition to display the error only if it is available.</p>

<p>The last step in serving the user signup page is adding this new webpart in the application.</p>

<p>To do this, we just need to call the <code>webPart</code> function while defining the <code>app</code> in the <code>main</code> function.</p>

<pre><code class="language-fsharp">// FsTweet.Web/FsTweet.Web.fs
// ...
let main argv =
  let app = 
    choose [
      // ...
      UserSignup.Suave.webPart ()
    ]
  // ...
</code></pre>

<p>That&rsquo;s it!</p>

<p>If we run the application and hit <code>http://localhost:8080/signup</code> in the browser, we can see the signup page</p>

<p><img src="/img/fsharp/series/fstweet/signup-form.png" alt="User Signup Form" /></p>

<h2 id="handling-signup-form-post-request">Handling Signup Form POST request</h2>

<p>To handle the POST request during the signup form submission, we need to have a WebPart configured.</p>

<p>On the same path <code>/signup</code> we need to have one WebPart for serving the signup page in response to GET request and an another for the POST request.</p>

<pre><code class="language-fsharp">// FsTweet.Web/UserSignup.fs
module Suave =
  // ...
  open Suave 
  // ...
  let webPart () =
    path &quot;/signup&quot; 
      &gt;=&gt; choose [
        GET &gt;=&gt; page &quot;user/signup.liquid&quot; emptyUserSignupViewModel
        POST &gt;=&gt; ???
      ]
</code></pre>

<p>To fill the placeholder <code>???</code>, let&rsquo;s add a new WebPart <code>handleUserSignup</code>, with a dummy implementation.</p>

<pre><code class="language-fsharp">// FsTweet.Web/UserSignup.fs
module Suave =
  // ...
  let handleUserSignup ctx = async {
    printfn &quot;%A&quot; ctx.request.form
    return! Redirection.FOUND &quot;/signup&quot; ctx
  }

  let webPart () =
    path &quot;/signup&quot; 
      &gt;=&gt; choose [
        // ...
        POST &gt;=&gt; handleUserSignup
      ]
</code></pre>

<p>The placeholder implementation of the <code>handleUserSignup</code> WebPart prints the form values posted (from the <a href="https://suave.io/Suave.html#def:member Suave.Http.HttpRequest.form" target="_blank">request</a>) in the console and redirects the user again to the signup page.</p>

<p>When we rerun the program with this new changes, we can find the values being posted in the console upon submitting the signup form.</p>

<pre><code class="language-bash">[(&quot;Email&quot;, Some &quot;demystifyfp@gmail.com&quot;); (&quot;Username&quot;, Some &quot;demystifyfp&quot;);
 (&quot;Password&quot;, Some &quot;secret&quot;); (&quot;Error&quot;, Some &quot;&quot;)]
</code></pre>

<h2 id="model-binding-using-suave-experimental">Model Binding Using Suave.Experimental</h2>

<p>In the previous section, the <code>handleUserSignup</code> WebPart got the form data that were posted using the <code>form</code> member of the <code>request</code>.</p>

<p>The <code>form</code> member is of type <code>(string * string option) list</code>.</p>

<p>We already have view model in place <code>UserSignupViewModel</code> to represent the same data. The next step is converting the data</p>

<pre><code class="language-bash">from {(string * string option) list} to {UserSignupViewModel}
</code></pre>

<p>In other words, we need to bind the request form data to the <code>UserSignupViewModel</code>.</p>

<p>There is an inbuilt support for doing this Suave using <code>Suave.Experimental</code> package.</p>

<p>Let&rsquo;s add this to our <code>FsTweet.Web</code> project using paket and forge.</p>

<pre><code class="language-bash">&gt; forge paket add Suave.Experimental -p src/FsTweet.Web/FsTweet.Web.fsproj
</code></pre>

<p>After we add the reference, we can make use of the <code>bindEmptyForm</code> function to carry out the model binding for us.</p>

<pre><code class="language-fsharp">val bindEmptyForm&lt;'a&gt; : (req : HttpRequest) -&gt; Choice&lt;'a, string&gt;
</code></pre>

<p>The <code>bindEmptyForm</code> function takes a request and returns either the value of the given type or an error message.</p>

<pre><code class="language-fsharp">// ...
module Suave = 
  // ...
  open Suave.Form 
  // ...

  let handleUserSignup ctx = async {
    match bindEmptyForm ctx.request with
    | Choice1Of2 (userSignupViewModel : UserSignupViewModel) -&gt;
      printfn &quot;%A&quot; userSignupViewModel
      return! Redirection.FOUND &quot;/signup&quot; ctx
    | Choice2Of2 err -&gt;
      let viewModel = {emptyUserSignupViewModel with Error = Some err}
      return! page &quot;user/signup.liquid&quot; viewModel ctx
  }
  // ...
</code></pre>

<p>As the <code>bindEmptyForm</code> function returns a <code>generic</code> type as its first option, we need to specify the type to enable the model binding explicitly.</p>

<p>If the model binding succeeds, we just print the view model and redirects the user to the signup page as we did in the previous section.</p>

<p>If it fails, we modify the viewModel with the error being returned and render the signup page again.</p>

<p>When we rerun the program and do the form post again, we will get the following output.</p>

<pre><code class="language-bash">{Username = &quot;demystifyfp&quot;;
 Email = &quot;demystifyfp@gmail.com&quot;;
 Password = &quot;secret&quot;;
 Error = None;}
</code></pre>

<h2 id="summary">Summary</h2>

<p>In this blog post, We started with rendering the signup form, and then we learned how to do view model binding using the <code>Suave.Experimental</code> library.</p>

<p>The source code is available on <a href="https://github.com/demystifyfp/FsTweet/tree/v0.3" target="_blank">GitHub</a></p>

    </div>
  </div>

</article>

<div class="container">
  <nav>
  <ul class="pager">
    
    <li class="previous"><a href="http://www.demystifyfp.com/fsharp/series/fstweet/static-assets/"><span
      aria-hidden="true">&larr;</span> Serving Static Asset Files</a></li>
    

    
    <li class="next"><a href="http://www.demystifyfp.com/fsharp/series/fstweet/user-signup-validation/">Validating New User Signup Form <span
      aria-hidden="true">&rarr;</span></a></li>
    
  </ul>
</nav>

</div>

<div class="article-container">
  
<section id="comments">
  <div id="disqus_thread">
    <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "demystifyfp" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </div>
</section>


</div>

<footer class="site-footer">
  <div class="container">
    <p class="powered-by">

      &copy; 2017 Demystify FP &middot; 

      Powered by the <a href="https://github.com/gcushen/hugo-academic" target="_blank">Academic
      theme</a> for <a href="http://gohugo.io" target="_blank">Hugo</a>.

      <span class="pull-right" aria-hidden="true">
        <a href="#" id="back_to_top">
          <span class="button_icon">
            <i class="fa fa-chevron-up fa-2x"></i>
          </span>
        </a>
      </span>

    </p>
  </div>
</footer>

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js" integrity="sha512-jGsMH83oKe9asCpkOVkBnUrDDTp8wl+adkB2D+//JtlxO4SrLoJdhbOysIFQJloQFD+C4Fl1rMsQZF76JjV0eQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.2/imagesloaded.pkgd.min.js" integrity="sha512-iHzEu7GbSc705hE2skyH6/AlTpOfBmkx7nUqTLGzPYR+C1tRaItbRlJ7hT/D3YQ9SV0fqLKzp4XY9wKulTBGTw==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.19.1/TweenMax.min.js" integrity="sha512-Z5heTz36xTemt1TbtbfXtTq5lMfYnOkXM2/eWcTTiLU01+Sw4ku1i7vScDc8fWhrP2abz9GQzgKH5NGBLoYlAw==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.19.1/plugins/ScrollToPlugin.min.js" integrity="sha512-CDeU7pRtkPX6XJtF/gcFWlEwyaX7mcAp5sO3VIu/ylsdR74wEw4wmBpD5yYTrmMAiAboi9thyBUr1vXRPA7t0Q==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha512-iztkobsvnjKfAtTNdHkGVjAYTrrtlC7mGp/54c40wowO7LhURYl3gVzzcEqGl/qKXQltJ2HwMrdLcNUdo+N/RQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
    
    <script src="/js/hugo-academic.js"></script>
    

    
    
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>

      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/languages/fsharp.min.js"></script>
      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    

  </body>
</html>

