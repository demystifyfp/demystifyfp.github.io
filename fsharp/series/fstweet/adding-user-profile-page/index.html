<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme" content="hugo-academic">
  <meta name="generator" content="Hugo 0.30.2" />
  
  <meta name="description" content="Demystifying">

  
  
  
  
    
  
  
    
    
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/vs.min.css">
    
  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha512-6MXa8B6uaO18Hid6blRMetEIoPqHf7Ux1tnyIQdpt9qI5OACx7C+O3IVTr98vwGnlcg0LOLa02i9Y1HpVhlfiw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.1/css/academicons.min.css" integrity="sha512-NThgw3XKQ1absAahW6to7Ey42uycrVvfNfyjqcFNgCmOCQ5AR4AO0SiXrN+8ZtYeappp56lk1WtvjVmEa+VR6A==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha512-SfTiTlX6kk+qitfevl/7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+/Sw==" crossorigin="anonymous">
  
  


  

  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:400,700%7cRoboto:400,400italic,700%7cRoboto&#43;Mono">
  
  <link rel="stylesheet" href="/styles.css">
  
  <link rel="stylesheet" href="/css/custom.css">
  

  

  
  <link rel="alternate" href="http://www.demystifyfp.com/index.xml" type="application/rss+xml" title="Demystify FP">
  <link rel="feed" href="http://www.demystifyfp.com/index.xml" type="application/rss+xml" title="Demystify FP">
  

  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/apple-touch-icon.png">

  <link rel="canonical" href="http://www.demystifyfp.com/fsharp/series/fstweet/adding-user-profile-page/">

  

  <title>Adding User Profile Page | Demystify FP</title>

</head>
<body id="top" data-spy="scroll" data-target="#navbar-main" data-offset="71">

<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
      <a class="navbar-brand" href="/">Demystify FP</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav navbar-right">
        

        

        <li class="nav-item">
          <a href="/#about">
            
            <span>Home</span>
          </a>
        </li>

        
        

        
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true">
            Books
            <span class="caret"></span>
          </a>
          <ul class="dropdown-menu">
            
            <li class="nav-item">
              <a href="http://products.tamizhvendan.in/fsharp-applied">
                
                <span>F# Applied</span>
              </a>
            </li>
            
          </ul>
        </li>

        
        

        
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true">
            Tutorials
            <span class="caret"></span>
          </a>
          <ul class="dropdown-menu">
            
            <li class="nav-item">
              <a href="/fsharp/series/fstweet">
                
                <span>Twitter Clone in F#</span>
              </a>
            </li>
            
          </ul>
        </li>

        
        

        
      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  


  <div class="article-container">
    <h1 itemprop="name">Adding User Profile Page</h1>
    

<div class="article-metadata">

  <span class="article-date">
    
    <time datetime="2017-10-24 20:18:33 &#43;0530 IST" itemprop="datePublished">
      Tue, Oct 24, 2017
    </time>
  </span>

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    10 min read
  </span>
  

  
  
  <span class="middot-divider"></span>
  <a href="http://www.demystifyfp.com/fsharp/series/fstweet/adding-user-profile-page/#disqus_thread"></a>
  

  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=Adding%20User%20Profile%20Page&amp;url=http%3a%2f%2fwww.demystifyfp.com%2ffsharp%2fseries%2ffstweet%2fadding-user-profile-page%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=http%3a%2f%2fwww.demystifyfp.com%2ffsharp%2fseries%2ffstweet%2fadding-user-profile-page%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2fwww.demystifyfp.com%2ffsharp%2fseries%2ffstweet%2fadding-user-profile-page%2f&amp;title=Adding%20User%20Profile%20Page"
         target="_blank" rel="noopener">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=http%3a%2f%2fwww.demystifyfp.com%2ffsharp%2fseries%2ffstweet%2fadding-user-profile-page%2f&amp;title=Adding%20User%20Profile%20Page"
         target="_blank" rel="noopener">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=Adding%20User%20Profile%20Page&amp;body=http%3a%2f%2fwww.demystifyfp.com%2ffsharp%2fseries%2ffstweet%2fadding-user-profile-page%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>

    <div class="article-style" itemprop="articleBody">
      

<p>Hi there!</p>

<p>Welcome back to the eighteenth part of <a href="TODO" target="_blank">Creating a Twitter Clone in F# using Suave</a> blog post series.</p>

<p>We are on the verge of completing the initial version of FsTweet. To say FsTweet as a Twitter clone, we should be able to follow other users and view their tweets in our wall page. To do it, we first need to have a user profile page where we can go and follow the user.</p>

<p>In this blog post, we are going to create the user profile page.</p>

<h2 id="the-user-profile-page">The User Profile Page</h2>

<p>We are going to consider the username of the user as the twitter handle in the user profile page and it will be served in the url <code>/{username}</code>.</p>

<p>The user profile page will be having the following UI Components.</p>

<ol>
<li><p>A Gravatar image of the user along with the username.</p></li>

<li><p>List of tweets tweeted by the given user</p></li>

<li><p>List of users that he/she following</p></li>

<li><p>List of his/her followers.</p></li>
</ol>

<blockquote>
<p>The components three and four will be addressed in the later blog posts.</p>
</blockquote>

<p>In addition to it, we also have to address the following three sceanrios in the profile page.</p>

<ol>
<li><p>Anyone should be able to view a profile of anybody else without logging in to the application. The anonymous user can only view the page.
<img src="/img/fsharp/series/fstweet/user_profile_guest.png" alt="User Profile Guest" /></p></li>

<li><p>If a logged in user visits an another user profile page, he/she should be able to follow him/her
<img src="/img/fsharp/series/fstweet/user_profile_other.png" alt="User Profile Other" /></p></li>

<li><p>If a logged in user visits his/her profile page, there should not be any provision to follow himself/herself.
<img src="/img/fsharp/series/fstweet/user_profile_self.png" alt="User Profile Self" /></p></li>
</ol>

<p>Let&rsquo;s dive in and implement the user profile page.</p>

<p>To start with we are going to implement the first UI Component, the gravatar image along with the username and we will also be addressing the above three scenarios.</p>

<h3 id="user-profile-liquid-template">User Profile Liquid Template</h3>

<p>Let&rsquo;s get started by creating the a new liquid template <em>profile.liqud</em> for the user profile page.</p>

<pre><code class="language-bash">&gt; touch src/FsTweet.Web/views/user/profile.liquid
</code></pre>

<p>Then update it as below</p>

<pre><code class="language-html">{% extends &quot;master_page.liquid&quot; %}

{% block head %}
  &lt;title&gt; {{model.Username}} - FsTweet &lt;/title&gt;
{% endblock %}

{% block content %}
&lt;div&gt;
  &lt;img src=&quot;{{model.GravatarUrl}}&quot; alt=&quot;&quot; class=&quot;gravatar&quot; /&gt;
  &lt;p class=&quot;gravatar_name&quot;&gt;@{{model.Username}}&lt;/p&gt;
  {% if model.IsLoggedIn %}
    {% unless model.IsSelf %}
      &lt;a href=&quot;#&quot; id=&quot;follow&quot; data-username=&quot;{{model.username}}&quot;&gt;Follow&lt;/a&gt;
    {% endunless %}
    &lt;a href=&quot;/logout&quot;&gt;Logout&lt;/a&gt;
  {% endif %}
&lt;/div&gt;
{% endblock %}
</code></pre>

<blockquote>
<p>Styles are ignored for brevity.</p>
</blockquote>

<p>We are using two boolean properties <code>IsLoggedIn</code> and <code>IsSelf</code> to show/hide the UI elements that we saw above.</p>

<p>The next step is adding the server side logic to render this template.</p>

<h2 id="rendering-user-profile-template">Rendering User Profile Template</h2>

<p>Create a new fsharp file <em>UserProfile.fs</em> and move it above <em>FsTweet.Web.fs</em></p>

<pre><code class="language-bash">&gt; forge newFs web -n src/FsTweet.Web/UserProfile

&gt; repeat 2 forge moveUp web -n src/FsTweet.Web/UserProfile.fs
</code></pre>

<p>As a first step, let&rsquo;s define a domain model for user profile</p>

<pre><code class="language-fsharp">// src/FsTweet.Web/UserProfile.fs
namespace UserProfile

module Domain = 
  open User
  
  type UserProfile = {
    User : User
    GravatarUrl : string
    IsSelf : bool
  }
</code></pre>

<p>Then add the <code>gravatarUrl</code> function that creates the gravatar URL from the user&rsquo;s email address.</p>

<pre><code class="language-fsharp">module Domain =
  // ...
  open System.Security.Cryptography
  
  // ...
  
  let gravatarUrl (emailAddress : UserEmailAddress) =
    use md5 = MD5.Create()
    emailAddress.Value 
    |&gt; System.Text.Encoding.Default.GetBytes
    |&gt; md5.ComputeHash
    |&gt; Array.map (fun b -&gt; b.ToString(&quot;x2&quot;))
    |&gt; String.concat &quot;&quot;
    |&gt; sprintf &quot;http://www.gravatar.com/avatar/%s?s=200&quot;
</code></pre>

<blockquote>
<p>The <code>gravatarUrl</code> function uses <a href="https://en.gravatar.com/site/implement/images/" target="_blank">this logic</a> to generate the URL.</p>
</blockquote>

<p>To simplify the creating a value of <code>UserProfile</code>, let&rsquo;s add a function <code>newUserProfile</code> to create <code>UserProfile</code> from <code>User</code>.</p>

<pre><code class="language-fsharp">// User -&gt; UserProfile
let newProfile user = { 
  User = user
  GravatarUrl = gravatarUrl user.EmailAddress
  IsSelf = false
}
</code></pre>

<p>Then add the <code>findUserProfile</code> function, which finds the user profile by username</p>

<pre><code class="language-fsharp">module Domain =
  // ...
  open Chessie.ErrorHandling
  
  // ...

  type FindUserProfile = 
    Username -&gt; AsyncResult&lt;UserProfile option, Exception&gt;

  // FindUser -&gt; Username -&gt; AsyncResult&lt;UserProfile option, Exception&gt;
  let findUserProfile (findUser : FindUser) username = asyncTrial {
    let! userMayBe = findUser username
    return Option.map newProfile userMayBe
  }
</code></pre>

<p>We are making use of the <code>findUser</code> function that we created while <a href="/fsharp/series/fstweet/handling-login-request/#finding-the-user-by-username" target="_blank">handling user login request</a></p>

<p>The next step is using this function to get the <code>UserProfile</code> if the user didn&rsquo;t login or the logged in user is looking to find an another user&rsquo;s profile.</p>

<p>If the <code>Username</code> of the logged in user matches with the <code>Username</code> that we are looking to find, we don&rsquo;t need call the <code>findUserProfile</code>. Instead we can use the <code>newProfile</code> function to get the profile from the <code>User</code> and modify its <code>IsSelf</code> property to <code>true</code>.</p>

<pre><code class="language-fsharp">
type HandleUserProfile = 
    Username -&gt; User option 
      -&gt; AsyncResult&lt;UserProfile option, Exception&gt;
      
// FindUserProfile -&gt; Username -&gt; User option 
//    -&gt; AsyncResult&lt;UserProfile option, Exception&gt;
let handleUserProfile 
      findUserProfile (username : Username) loggedInUserMayBe  = asyncTrial {

    match loggedInUserMayBe with
    | None -&gt; 
      return! findUserProfile username
    | Some (user : User) -&gt; 
      if user.Username = username then
        let userProfile =
          {newProfile user with IsSelf = true}
        return Some userProfile
      else  
        return! findUserProfile username

  }
</code></pre>

<p>Now we have the domain logic for finding user profile in place and let&rsquo;s turn our attention to the presentation logic!</p>

<p>As we did for other pages, create a new module <code>Suave</code> and define a view model for the profile page.</p>

<pre><code class="language-fsharp">// src/FsTweet.Web/UserProfile.fs
namespace UserProfile
//...

module Suave =
  type UserProfileViewModel = {
    Username : string
    GravatarUrl : string
    IsLoggedIn : bool
    IsSelf : bool
  }
</code></pre>

<p>Then add a function <code>newUserProfileViewModel</code> which creates <code>UserProfileViewModel</code> from <code>UserProfile</code>.</p>

<pre><code class="language-fsharp">module Suave =
  open Domain
  // ...

  // UserProfile -&gt; UserProfileViewModel
  let newUserProfileViewModel (userProfile : UserProfile) = {
    Username = userProfile.User.Username.Value
    GravatarUrl = userProfile.GravatarUrl
    IsLoggedIn = false
    IsSelf = userProfile.IsSelf
  }
</code></pre>

<p>The next step is transforming the return type (<code>AsyncResult&lt;UserProfile option, Exception&gt;</code>) of the <code>handleUserProfile</code> to <code>Async&lt;WebPart&gt;</code>. To do it we first need to define what we will be doing on success and on failure.</p>

<pre><code class="language-fsharp">// src/FsTweet.Web/UserProfile.fs
// ...
module Suave =
  // ...
  open Suave.DotLiquid
  open Chessie
  open System
  // ...

  let renderUserProfilePage (vm : UserProfileViewModel) = 
    page &quot;user/profile.liquid&quot; vm
  let renderProfileNotFound =
    page &quot;not_found.liquid&quot; &quot;user not found&quot;

  // bool -&gt; UserProfile option -&gt; WebPart
  let onHandleUserProfileSuccess isLoggedIn userProfileMayBe = 
    match userProfileMayBe with
    | Some (userProfile : UserProfile) -&gt; 
      let vm = { newUserProfileViewModel userProfile with
                  IsLoggedIn = isLoggedIn }
      renderUserProfilePage vm
    | None -&gt; 
      renderProfileNotFound

  // System.Exception -&gt; WebPart
  let onHandleUserProfileFailure (ex : Exception) =
    printfn &quot;%A&quot; ex
    page &quot;server_error.liquid&quot; &quot;something went wrong&quot;
</code></pre>

<p>Then wire these functions up with the actual request handler.</p>

<pre><code class="language-fsharp">// HandleUserProfile -&gt; string -&gt; User option -&gt; WebPart
let renderUserProfile handleUserProfile username loggedInUser ctx = async {
  match Username.TryCreate username with
  | Success validatedUsername -&gt; 
    let isLoggedIn = 
      Option.isSome loggedInUser
    let onSuccess = 
      onHandleUserProfileSuccess isLoggedIn
    let! webpart = 
      handleUserProfile validatedUsername loggedInUser
      |&gt; AR.either onSuccess onHandleUserProfileFailure
    return! webpart ctx
  | Failure _ -&gt; 
    return! renderProfileNotFound ctx
}
</code></pre>

<p>The final step is exposing this function and adding a HTTP route.</p>

<pre><code class="language-fsharp">// src/FsTweet.Web/UserProfile.fs
// ...
module Suave =
  // ...
  open Database
  open Suave.Filters
  open Auth.Suave
  // ...

  let webpart (getDataCtx : GetDataContext) = 
    let findUserProfile = findUserProfile (Persistence.findUser getDataCtx)
    let handleUserProfile = handleUserProfile findUserProfile
    let renderUserProfile = renderUserProfile handleUserProfile
    pathScan &quot;/%s&quot; (fun username -&gt; mayRequiresAuth (renderUserProfile username))
</code></pre>

<pre><code class="language-diff">// FsTweet.Web/FsTweet.Web.fs
// ...
let main argv =
  // ...
  let app = 
    choose [
      // ...
+     UserProfile.Suave.webPart getDataCtx
    ]
  // ...
</code></pre>

<blockquote>
<p>We need to make sure that this webpart should be the last item in the <code>choose</code> list as the path <code>/%s</code> matches every path that has this pattern.</p>
</blockquote>

<p>To test drive this new feature, run the application and view the user profile as an anonymous user. Then singup some new users (make sure you verify their email id) and then login and view other users profile.</p>

<blockquote>
<p>We haven&rsquo;t added logout yet. So, to login as a new user either clear the cookies in the brower or restart your browser.</p>
</blockquote>

<h3 id="adding-user-feed">Adding User Feed</h3>

<p>The next UI Component that we need to implement is the tweet feed of the user. Unlike the user feed that we implement in the pevious post, here we are just going to fetch his/her tweets and going to show as a history.</p>

<p>To enable it we have to pass the GetStream.io&rsquo;s configuration and user details to the client side. Let&rsquo;s add them as properties in the <code>UserProfileViewModel</code>.</p>

<pre><code class="language-fsharp">// src/FsTweet.Web/UserProfile.fs
// ...
module Suave =
  // ...
  type UserProfileViewModel = {
    // ...
    UserId : int
    UserFeedToken : string
    ApiKey : string
    AppId : string
  }
  // ...
</code></pre>

<p>Then add the <code>getStreamClient</code> parameter to the <code>newUserProfileViewModel</code> function and populate the newly added properties.</p>

<pre><code class="language-diff">-  let newUserProfileViewModel (userProfile : UserProfile) = {
-    Username = userProfile.User.Username.Value
-    GravatarUrl = userProfile.GravatarUrl
-    IsLoggedIn = false
-    IsSelf = userProfile.IsSelf
-  }

+  let newUserProfileViewModel 
+       (getStreamClient : GetStream.Client) (userProfile : UserProfile) = 
+
+    let (UserId userId) = userProfile.User.UserId
+    let userFeed = GetStream.userFeed getStreamClient userId
+    {
+      Username = userProfile.User.Username.Value
+      GravatarUrl = userProfile.GravatarUrl
+      IsLoggedIn = false
+      IsSelf = userProfile.IsSelf
+      UserId = userId
+      UserFeedToken = userFeed.ReadOnlyToken
+      ApiKey = getStreamClient.Config.ApiKey
+      AppId = getStreamClient.Config.AppId
+    }
</code></pre>

<p>Now you will be getting compiler errors as the <code>onHandleUserProfileSuccess</code> function was directly calling the <code>newUserProfileViewModel</code> function and it doesn&rsquo;t have <code>getStreamClient</code> to pass the argument.</p>

<p>Instead of passing the value of <code>GetStream.Client</code> around, we can partially apply it in the <code>webpart</code> function and pass the partially applied <code>onHandleUserProfileSuccess</code> function as argument to the <code>renderUserProfile</code> function and eventually to the <code>onHandleUserProfileSuccess</code> function.</p>

<pre><code class="language-diff">-  let webpart (getDataCtx : GetDataContext) = 
+  let webpart  (getDataCtx : GetDataContext) getStreamClient = 
     ...
-    let renderUserProfile = renderUserProfile handleUserProfile
+    let newUserProfileViewModel = newUserProfileViewModel getStreamClient
+    let renderUserProfile = renderUserProfile newUserProfileViewModel handleUserProfile
     ...
</code></pre>

<pre><code class="language-diff">-  let renderUserProfile handleUserProfile username loggedInUser  ctx = async {
+  let renderUserProfile 
+       newUserProfileViewModel handleUserProfile username loggedInUser  ctx = async {

     match Username.TryCreate username with
     | Success validatedUsername -&gt; 
       let isLoggedIn = Option.isSome loggedInUser
       let onSuccess = 
-        onHandleUserProfileSuccess isLoggedIn
+        onHandleUserProfileSuccess newUserProfileViewModel isLoggedIn
</code></pre>

<pre><code class="language-diff">-  let onHandleUserProfileSuccess isLoggedIn userProfileMayBe = 
+  let onHandleUserProfileSuccess newUserProfileViewModel isLoggedIn userProfileMayBe = 
</code></pre>

<p>The final step is passing the <code>getStreamClient</code> from the application&rsquo;s main function.</p>

<pre><code class="language-diff">// FsTweet.Web/FsTweet.Web.fs
// ...
let main argv =
  // ...
  let app = 
    choose [
      // ...
-     UserProfile.Suave.webPart getDataCtx
+     UserProfile.Suave.webPart getDataCtx getStreamClient
    ]
  // ...
</code></pre>

<p>With this we are done with the server side changes for showing a user feed in the user profile page.</p>

<p>The next change that we need to do is on the liquid template <em>profile.liquid</em></p>

<p>First, add a placeholder for showing the user feed</p>

<pre><code class="language-html">&lt;!-- user/profile.liquid --&gt;
&lt;!-- ... --&gt;
{% block content %}
&lt;div&gt;
  &lt;!-- ... --&gt;
  &lt;div id=&quot;tweets&quot; /&gt;
&lt;/div&gt;
{% endblock %}
</code></pre>

<p>Then as we did in the <a href="/fsharp/series/fstweet/adding-user-feed/#initializing-getstream-io-js-library" target="_blank">last blog post</a>, define a <code>scripts</code> block and pass the GetStream.io&rsquo;s initialization values to the client side.</p>

<pre><code class="language-html">&lt;!-- user/profile.liquid --&gt;
&lt;!-- ... --&gt;

{% block scripts %}
&lt;script src=&quot;/assets/js/lib/getstream.js&quot;&gt; &lt;/script&gt;

&lt;script type=&quot;text/javascript&quot;&gt;
  window.fsTweet = {
    user : {
      id : &quot;{{model.UserId}}&quot;,
      name : &quot;{{model.Username}}&quot;,
      feedToken : &quot;{{model.UserFeedToken}}&quot;
    },
    stream : {
      appId : &quot;{{model.AppId}}&quot;,
      apiKey : &quot;{{model.ApiKey}}&quot;
    }
  }  
&lt;/script&gt;

&lt;script src=&quot;/assets/js/tweet.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;/assets/js/profile.js&quot;&gt;&lt;/script&gt;
{% endblock %}
</code></pre>

<p>The <em>profile.js</em> that we are referring here is not added yet. So, let&rsquo;s add it</p>

<pre><code class="language-js">// assets/js/profile.js
$(function(){
  let client = 
    stream.connect(fsTweet.stream.apiKey, null, fsTweet.stream.appId);
  let userFeed = 
    client.feed(&quot;user&quot;, fsTweet.user.id, fsTweet.user.feedToken);

  userFeed.get({
    limit: 25
  }).then(function(body) {
    $(body.results.reverse()).each(function(index, tweet){
      renderTweet($(&quot;#tweets&quot;), tweet);
    });
  })
});
</code></pre>

<p>The code is straight-forward, we are initializing the GetStream.io&rsquo;s client and the user feed. And then we are retreving the last 25 tweets of the user.</p>

<p>Awesome!.</p>

<p>Now if we run the app and visits a user profile, we can see his/her tweets!</p>

<h2 id="adding-logout">Adding Logout</h2>

<p>Adding the logout functionality in very simple. Thanks to the <code>deauthenticate</code> WebPart from the <code>Suave.Authentication</code> module which clears both the authentication and the state cookie.</p>

<p>Post logout we just need to redirect the user to the login page.</p>

<pre><code class="language-diff">module Suave =
   ...

   let webpart getDataCtx =
     let findUser = Persistence.findUser getDataCtx
-    path &quot;/login&quot; &gt;=&gt; choose [
-      GET &gt;=&gt; mayRequiresAuth (renderLoginPage emptyLoginViewModel)
-      POST &gt;=&gt; handleUserLogin findUser
+    choose [
+      path &quot;/login&quot; &gt;=&gt; choose [
+        GET &gt;=&gt; mayRequiresAuth (renderLoginPage emptyLoginViewModel)
+        POST &gt;=&gt; handleUserLogin findUser
+      ]
+      path &quot;/logout&quot; &gt;=&gt; deauthenticate &gt;=&gt; redirectToLoginPage
     ]
</code></pre>

<h2 id="summary">Summary</h2>

<p>In this blog post, we implemented the user profile page with the help of the abstractions that we built earlier. Then we added the logout functionality.</p>

<p>The source code associated with this blog post is available on <a href="https://github.com/demystifyfp/FsTweet/tree/v0.17" target="_blank">GitHub</a></p>

    </div>

    
    
    
    <div class="article-tags">
      
      <a class="btn btn-primary btn-outline" href="/tags/suave">suave</a>
      
      <a class="btn btn-primary btn-outline" href="/tags/dotliquid">DotLiquid</a>
      
      <a class="btn btn-primary btn-outline" href="/tags/fsharp">fsharp</a>
      
      <a class="btn btn-primary btn-outline" href="/tags/chessie">chessie</a>
      
      <a class="btn btn-primary btn-outline" href="/tags/getstream">getstream</a>
      
    </div>
    
    

  </div>

</article>



<div class="article-container article-widget">
  <div class="hr-light"></div>
  <h3>Related</h3>
  <ul>
    
    <li><a href="/fsharp/series/fstweet/adding-user-feed/">Adding User Feed</a></li>
    
    <li><a href="/fsharp/series/fstweet/posting-new-tweet/">Posting New Tweet</a></li>
    
    <li><a href="/fsharp/series/fstweet/adding-login/">Adding Login Page</a></li>
    
    <li><a href="/fsharp/series/fstweet/verifying-user-email/">Verifying User Email</a></li>
    
    <li><a href="/fsharp/series/fstweet/user-signup-validation/">Validating New User Signup Form</a></li>
    
  </ul>
</div>




<div class="article-container">
  
<section id="comments">
  <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "demystifyfp" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>


</div>

<footer class="site-footer">
  <div class="container">
    <p class="powered-by">

      &copy; 2017 Demystify FP &middot; 

      Powered by the
      <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
      <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

      <span class="pull-right" aria-hidden="true">
        <a href="#" id="back_to_top">
          <span class="button_icon">
            <i class="fa fa-chevron-up fa-2x"></i>
          </span>
        </a>
      </span>

    </p>
  </div>
</footer>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close btn-large" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Cite</h4>
      </div>
      <div>
        <pre><code class="modal-body tex"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-primary btn-outline js-copy-cite" href="#" target="_blank">
          <i class="fa fa-copy"></i> Copy
        </a>
        <a class="btn btn-primary btn-outline js-download-cite" href="#" target="_blank">
          <i class="fa fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    
    <script id="dsq-count-scr" src="//demystifyfp.disqus.com/count.js" async></script>
    

    

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha512-3P8rXCuGJdNZOnUx/03c1jOTnMn3rP63nBip5gOP2qmUh5YAdVAvFZ1E+QLZZbC1rtMrQb+mah3AfYW11RUrWA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.3/imagesloaded.pkgd.min.js" integrity="sha512-umsR78NN0D23AzgoZ11K7raBD+R6hqKojyBZs1w8WvYlsI+QuKRGBx3LFCwhatzBunCjDuJpDHwxD13sLMbpRA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha512-iztkobsvnjKfAtTNdHkGVjAYTrrtlC7mGp/54c40wowO7LhURYl3gVzzcEqGl/qKXQltJ2HwMrdLcNUdo+N/RQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
    
    
    <script src="/js/hugo-academic.js"></script>
    
    <script src="/js/custom.js"></script>
    

    
    
      
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
      

      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/fsharp.min.js"></script>
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/diff.min.js"></script>
      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    

  </body>
</html>

